<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Linen Cropped Utility Jacket - Dealora</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="catalog-page">

  <!-- ‚úÖ Header -->
  <header class="main-header">
    <div class="left-side">
      <a href="home.html" class="logo">DEALORA</a>
      <nav class="nav">
        <!-- Optional menu -->
      </nav>
    </div>

    <div class="right-side">
      <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search" />
      </div>
      <i class="fas fa-heart"></i>
      <a href="signin.html" title="Account"><i class="fas fa-user"></i></a>
      <i class="fas fa-bag-shopping"></i>
    </div>
  </header>

  <!-- ‚úÖ Product Details -->
  <div class="product-detail">
    <img id="product-image" src="" alt="Product Image" />
    <div class="product-info">
      <p>LISA ARMSTRONG EDIT</p>
      <h2 id="product-name">Product Name</h2>
      <p class="price" id="product-price">000sr</p>

      <div class="colors">
        <p>Colour: Brown</p>
        <span class="color-circle color-brown"></span>
        <span class="color-circle color-gray"></span>
      </div>

      <div class="sizes">
        <p>Size:</p>
        <button>6</button><button>8</button><button>10</button>
        <button>12</button><button>14</button><button>16</button><button>18</button>
      </div>

      <button class="add-to-bag">ADD TO BAG</button>
      <button id="joinUnlockBtn" class="add-to-bag">Join to Unlock</button>
      <p id="queueInfo" style="margin-top: 10px; font-weight: bold;"></p>
    </div>
  </div>

  <!-- ‚úÖ JavaScript -->
  <script>
    // Load product details from query parameters
    const params = new URLSearchParams(window.location.search);
    const image = params.get("image");
    const name = params.get("name");
    const price = params.get("price");

    if (image && name && price) {
      document.getElementById("product-image").src = "image/" + decodeURIComponent(image);
      document.getElementById("product-name").textContent = decodeURIComponent(name);
      document.getElementById("product-price").textContent = decodeURIComponent(price);
    }

    // Color selection logic
    document.querySelectorAll('.color-circle').forEach(circle => {
      circle.addEventListener('click', () => {
        document.querySelectorAll('.color-circle').forEach(c => c.classList.remove('selected'));
        circle.classList.add('selected');
      });
    });

    // Size selection logic
    document.querySelectorAll('.sizes button').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.sizes button').forEach(b => b.classList.remove('selected'));
        button.classList.add('selected');
      });
    });

    // Join to Unlock logic
    document.getElementById('joinUnlockBtn').addEventListener('click', async () => {
      const email = prompt("Enter your email to join the discount queue:");
      const productId = document.getElementById("product-name").textContent.trim();

      if (!email) {
        alert("‚ö†Ô∏è Email is required!");
        return;
      }

      try {
        const res = await fetch('http://localhost:3000/api/unlock-queue', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, productId })
        });

        const data = await res.json();

     
        if (data.message === "‚úÖ Added to unlock queue") {
          alert(`‚úÖ Joined the queue! There are now ${data.queueLength} people.`);
        } else if (data.message === "You have already joined the queue for this product") {
          alert(`‚ÑπÔ∏è You are already in the queue. Total: ${data.queueLength} people.`);
        } else {
          alert("‚ùå " + data.message);
        }

        document.getElementById("queueInfo").textContent = `üî• Current queue size: ${data.queueLength}`;
      } catch (err) {
        alert("‚ùå Server error");
        console.error(err);
      }
    });
  </script>

</body>
</html>

